<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.travelAlone.s20230404.CommonMapper">

		<select id="interestFindById" resultType="Interest" >
			<![CDATA[
			select i.interest_id, i.member_id, i.i_common_interest, i.create_date, i.modified_date, c.word
			from interest i inner join common c on i.i_common_interest = concat(c.bcd, c.mcd)
			where i.member_id = #{memberId}
			]]>
		</select>

		<select id="scoreCountById" resultType="ScoreCount" >
			<![CDATA[
			SELECT 	  NVL(COUNT(s.s_common_spec), 0) AS count, c.word
			FROM 	  common c 
			LEFT JOIN score s 
			ON 		  s.s_common_spec = c.bcd || c.mcd 
			AND 	  s.member_id = #{memberId}
			WHERE 	  c.bcd like 'scr'
			GROUP BY  c.word
			]]>
		</select>

		<select id="writingCountById" resultType="WritingCount" >
			<![CDATA[
			SELECT a.board_count, b.hou_review_count, c.res_review_count, d.tra_review_count,e.favorites_count,f.g_writing_count
			FROM (SELECT COUNT(*) as board_count  FROM board WHERE member_id = #{memberId} AND b_re_level = 0 ) a ,
				 (SELECT COUNT(*) as hou_review_count FROM HOU_REV WHERE MEMBER_id = #{memberId}) b ,
				 (SELECT COUNT(*) as res_review_count FROM res_REV WHERE MEMBER_id = #{memberId}) c ,
				 (SELECT COUNT(*) as tra_review_count FROM tra_REV WHERE MEMBER_id = #{memberId}) d ,
				 (SELECT (SELECT COUNT(*) FROM TRA_FAV c WHERE c.Member_id = #{memberId}) + 
				 		 (SELECT COUNT(*) FROM res_FAV b WHERE b.Member_id = #{memberId}) + 
				 		 (SELECT COUNT(*) FROM hou_FAV a WHERE a.Member_id = #{memberId}) as favorites_count from dual) e ,
				 (SELECT COUNT(*) as g_writing_count FROM g_writing WHERE MEMBER_id = #{memberId}) f
			]]>
		</select>

		<update id="mypageMemberInfoUpdate" parameterType="Member" >
			<![CDATA[
			UPDATE MEMBER
			SET M_NICKNAME = #{m_nickname},
				M_PHONE    = #{m_phone}
			WHERE MEMBER_ID = #{member_id}
			]]>
		</update>

		<update id="mypageMemberProfileUpdate" parameterType="Member" >
			<![CDATA[
			UPDATE MEMBER
			SET M_IMG_CONTEXT = #{m_img_context},
				M_IMG_ORIGINAL_FILE = #{m_img_original_file},
				M_IMG_STORED_FILE = #{m_img_stored_file},
				M_COMMON_IMAGESTYPE = #{m_common_imagestype}
			WHERE MEMBER_ID = #{member_id}
			]]>
		</update>

		<delete id="mypageMemberWithdrawal">
			DELETE FROM MEMBER
			WHERE MEMBER_ID = #{id}
		</delete>

		<select id="mypageReviewShowhouse" resultType="MypageReviewResponseDto" parameterType="MypageReviewRequestDto" >
		<![CDATA[
		SELECT *
		FROM	(	Select *
					from HOU_REV
					where member_id = #{memberId}
					Order by create_date desc	)
		WHERE ROWNUM BETWEEN 10*(#{page}-1)+1 AND 10*#{page}
		]]>
		</select>

		<select id="mypageReviewShowrestaurant" resultType="MypageReviewResponseDto" parameterType="MypageReviewRequestDto" >
		<![CDATA[
		SELECT *
		FROM	(	Select *
					 from RES_REV
					 where member_id = #{memberId}
					 Order by create_date desc	)
		WHERE ROWNUM BETWEEN 10*(#{page}-1)+1 AND 10*#{page}
		]]>
		</select>

		<select id="mypageReviewShowtravel" resultType="MypageReviewResponseDto" parameterType="MypageReviewRequestDto" >
		<![CDATA[
		SELECT *
		FROM	(	Select *
					 from TRA_REV
					 where member_id = #{memberId}
					 Order by create_date desc	)
		WHERE ROWNUM BETWEEN 10*(#{page}-1)+1 AND 10*#{page}
		]]>
		</select>

		<select id="memberInfo" resultType="Member">
		<![CDATA[
		SELECT 	*
		FROM	MEMBER
		WHERE 	MEMBER_ID = #{member_id}
		]]>
		</select>

		<select id="kmTotalInquire" resultType="int">
			select Count(*)
			FROM G_WRITING
			WHERE MEMBER_ID = #{id}
		</select>

</mapper>
